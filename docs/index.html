<html>
<head>
  <meta charset="utf-8">

  <title>Wine About It</title>
  <meta name="author" content="Jen Lamere">

    <style type="text/css">
    .masthead   {
        height: 30%;
        background-color: #502127 !important;
    }
    #footer{
        background-color: #502127;
        height: 4%;
        position: fixed;
        bottom:0px;
        width:100%;
        color: white;
    }
    .dropdown{
        margin: 20px !important;
    }

    </style>
</head>

<body>
    <div class="pusher">
        <div class="ui inverted vertical masthead center aligned segment">
            <div class="ui text container">
                <h1 class = "ui inverted header"> <i class="circular cocktail icon"></i></h1>
                <h1 class="ui inverted header">Wine.About.It </h1>
                <h3>Get yourself to drink better wine</h3>
            </div>
        </div>
    </div>
    <div class="ui page grid">
        <div class="two column row">
            <div class="column"> 
                <div class="row">
                    <div class="ui floating dropdown labeled search icon button center right floated" id="favWine">
                    <i class="heart icon"></i>
                    <span class="text">Select your favorite wine</span>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="row">                 
                    <div class="ui floating dropdown labeled search icon button center" id="newWine">
                        <i class="empty heart icon"></i>
                        <span class="text">Wine you want to like </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="ui one column stackable center aligned page grid">
        <div class="column twelve wide">
            <button class="ui secondary basic button" id = "button">Find my wine!</button>
        </div>
    </div>
    <div class="ui one column stackable center aligned page grid">
        <div class="column wide">
            <div class = "wine_list"></div>
        </div>
    </div>

<div id ="footer">
<center>
 Jen Lamere 2016
</center>
</div>


<script src="./graphlib.min.js"></script>
<script src="./jquery-3.1.1.min.js"></script>
<script src="./similarity.js"></script>
<script src="./prototypes.js"></script>
<link rel="stylesheet" type="text/css" href="./semantic.min.css">
<script src="./semantic.min.js"></script>
<script>
    wine_prototypes_array = prototypes.split(';');
    wine_prototypes = {}
    for(var i = 0; i < wine_prototypes_array.length; i++){
        splitVals = wine_prototypes_array[i].split(',')
        wine_prototypes[splitVals[0]] = {
            "Attributes" : splitVals[1],
            "Type" : splitVals[2]
        }
    }

    wine_names = []
    var graph = new Graph();
    // populate data
    for (var row in data){
        wine_sim = data[row].split(',')
        wine_names.push(wine_sim[0])
        graph.addEdge(wine_sim[0], wine_sim[1], wine_sim[2]);
    }
    wine_names = $.unique(wine_names);
    
    $('.ui.dropdown').dropdown();
    dropdownHTML = ""
    for(w in wine_names){
        dropdownHTML += '<div class="item" data-value="' + wine_names[w] + '">' + wine_names[w] + '</div>'
    }

    initial_wine = null
    start_wine = null
    final_wine =  null

    $('#favWine .menu').html(dropdownHTML);
    $('#favWine').dropdown({
         onChange: function(val) {
            initial_wine= val
            start_wine = val
         }
    });
    $('#newWine .menu').html(dropdownHTML);
    $('#newWine').dropdown({
         onChange: function(val) {
            final_wine = val

         }
    });


    $('#button').click(function(){
        if(!final_wine){
            $("#newWine").addClass('error');
        }
        if(!initial_wine){
            $("#favWine").addClass('error');
        }
        else if (initial_wine && final_wine){
            $("#favWine").removeClass('error');
            $("#newWine").removeClass('error');
            $("#button").addClass('loading');

            path = graph.dijkastra(start_wine, final_wine);

            var html = "";
            for(html_item in path){
                html += build_header(path[html_item]);
            }
            $( ".wine_list" ).prepend('<div class="ui steps">' + html);
            $("#button").removeClass('loading');            


        }
    })

    
    function build_header(wine_name){
      return '<div class="step"><i class="cocktail icon"></i><div class="content"><div class="title">' + wine_name + '</div><div class="description">' + wine_prototypes[wine_name]["Type"] + "<h6>" +wine_prototypes[wine_name]["Attributes"] + '</h6></div></div></div>'
      
    }

    function Graph(){
        n = {};
        var INFINITY = 1/0;

        this.viewNodes = function(){
            console.log(n);
        }
        this.addEdge = function(name, wineTwo, weight){
            if(!n[name]){
                n[name] = {};
            }
            n[name][wineTwo] = weight;
        }

        this.dijkastra = function(startWine, endWine){
            var priorityQueue = new PQ();
            var distances = {};
            var parent = {};
            var path = [];

            for(node in n){
                if(node == startWine){
                    distances[startWine] = 0;
                    priorityQueue.addNode(startWine,0);
                }

                else{
                    distances[node] = INFINITY;
                    priorityQueue.addNode(node, INFINITY);
                }
                parent[node] = null;

            }
            while(!priorityQueue.isEmpty()){
                smallest = priorityQueue.removeNode();
                if(!smallest || distances[smallest] === INFINITY){
                    continue;
                }
                if(smallest == endWine){
                    while(parent[smallest]) {
                        path.push(smallest);
                        smallest = parent[smallest];
                    }
                    path.push(startWine)
                    return path.reverse();
                }
            
                for(neighbor in n[smallest]){
                    dist = parseFloat(distances[smallest]) + parseFloat(n[smallest][neighbor]);
                    if(dist < distances[neighbor]){
                        distances[neighbor] = dist;
                        parent[neighbor] = smallest;
                        priorityQueue.addNode(neighbor, dist);
                    }
                }
            }
            return null;
        }
    }
    function PQ(){
        this._nodes = [];
        this.printNodes = function(){
            console.log(this._nodes);
        }
        this.addNode = function(index, weight){
            this._nodes.push({index:index, weight:weight})
            this._nodes.sort();
       }
       this.removeNode = function(){
            return this._nodes.shift().index;
       }
       this.sort = function(){
        this._nodes.sort(function (nodeOne, nodeTwo){
            return nodeOne.weight - nodeTwo.weight;
            });
        }
        this.isEmpty = function(){
            return !this._nodes.length;
        }
       }
</script>
</body>
</html>